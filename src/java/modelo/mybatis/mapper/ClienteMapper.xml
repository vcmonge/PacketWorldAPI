<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cliente">

    <select id="obtener-clientes" resultType="pojo.Cliente">
        SELECT 
            cl.idCliente, 
            cl.nombre, 
            cl.apellidoPaterno, 
            cl.apellidoMaterno, 
            cl.telefono, 
            cl.correo, 
            cl.idDireccion,
            d.calle,
            d.numero,
            d.idColonia,
            col.nombre AS nombreColonia,
            col.codigo_postal AS codigoPostal,
            m.nombre AS ciudad,
            e.nombre AS estado,
            CONCAT_WS(', ', CONCAT_WS(' ', d.calle, d.numero), NULLIF(col.nombre, ''), CONCAT('C.P. ', NULLIF(col.codigo_postal, '')), NULLIF(m.nombre, ''), NULLIF(e.nombre, '') ) AS direccionCompleta
        FROM cliente cl
        INNER JOIN direccion d ON cl.idDireccion = d.idDireccion
        LEFT JOIN colonias col ON d.idColonia = col.id
        LEFT JOIN municipios m ON col.municipio = m.id
        LEFT JOIN estados e ON m.estado = e.id
    </select>
    
    <select id="buscar-cliente-nombre" resultType="pojo.Cliente" parameterType="string">
        SELECT 
            cl.idCliente, 
            cl.nombre, 
            cl.apellidoPaterno, 
            cl.apellidoMaterno, 
            cl.telefono, 
            cl.correo, 
            cl.idDireccion,
            d.calle,
            d.numero,
            d.idColonia,
            col.nombre AS nombreColonia,
            col.codigo_postal AS codigoPostal,
            m.nombre AS ciudad,
            e.nombre AS estado,
            CONCAT_WS(', ', CONCAT_WS(' ', d.calle, d.numero), NULLIF(col.nombre, ''), CONCAT('C.P. ', NULLIF(col.codigo_postal, '')), NULLIF(m.nombre, ''), NULLIF(e.nombre, '') ) AS direccionCompleta
        FROM cliente cl
        INNER JOIN direccion d ON cl.idDireccion = d.idDireccion
        LEFT JOIN colonias col ON d.idColonia = col.id
        LEFT JOIN municipios m ON col.municipio = m.id
        LEFT JOIN estados e ON m.estado = e.id
        WHERE cl.nombre LIKE CONCAT('%', #{_parameter}, '%')
           OR cl.apellidoPaterno LIKE CONCAT('%', #{_parameter}, '%')
           OR cl.apellidoMaterno LIKE CONCAT('%', #{_parameter}, '%')
           OR CONCAT_WS(' ', cl.nombre, cl.apellidoPaterno, cl.apellidoMaterno) LIKE CONCAT('%', #{_parameter}, '%')
    </select>

    <select id="buscar-cliente-correo" resultType="pojo.Cliente" parameterType="string">
        SELECT 
            cl.idCliente, 
            cl.nombre, 
            cl.apellidoPaterno, 
            cl.apellidoMaterno, 
            cl.telefono, 
            cl.correo, 
            cl.idDireccion,
            d.calle,
            d.numero,
            d.idColonia,
            col.nombre AS nombreColonia,
            col.codigo_postal AS codigoPostal,
            m.nombre AS ciudad,
            e.nombre AS estado,
            CONCAT_WS(', ', CONCAT_WS(' ', d.calle, d.numero), NULLIF(col.nombre, ''), CONCAT('C.P. ', NULLIF(col.codigo_postal, '')), NULLIF(m.nombre, ''), NULLIF(e.nombre, '') ) AS direccionCompleta
        FROM cliente cl
        INNER JOIN direccion d ON cl.idDireccion = d.idDireccion
        LEFT JOIN colonias col ON d.idColonia = col.id
        LEFT JOIN municipios m ON col.municipio = m.id
        LEFT JOIN estados e ON m.estado = e.id
        WHERE cl.correo = #{_parameter}
    </select>

    <select id="buscar-cliente-telefono" resultType="pojo.Cliente" parameterType="string">
        SELECT 
            cl.idCliente, 
            cl.nombre, 
            cl.apellidoPaterno, 
            cl.apellidoMaterno, 
            cl.telefono, 
            cl.correo, 
            cl.idDireccion,
            d.calle,
            d.numero,
            d.idColonia,
            col.nombre AS nombreColonia,
            col.codigo_postal AS codigoPostal,
            m.nombre AS ciudad,
            e.nombre AS estado,
            CONCAT_WS(', ', CONCAT_WS(' ', d.calle, d.numero), NULLIF(col.nombre, ''), CONCAT('C.P. ', NULLIF(col.codigo_postal, '')), NULLIF(m.nombre, ''), NULLIF(e.nombre, '') ) AS direccionCompleta
        FROM cliente cl
        INNER JOIN direccion d ON cl.idDireccion = d.idDireccion
        LEFT JOIN colonias col ON d.idColonia = col.id
        LEFT JOIN municipios m ON col.municipio = m.id
        LEFT JOIN estados e ON m.estado = e.id
        WHERE cl.telefono = #{_parameter}
    </select>
    
    <insert id="registrar-cliente" parameterType="pojo.Cliente">
        INSERT INTO cliente (nombre, apellidoPaterno, apellidoMaterno, telefono, correo, idDireccion) 
        VALUES (#{nombre}, #{apellidoPaterno}, #{apellidoMaterno}, #{telefono}, #{correo}, #{idDireccion})
    </insert>
    
    <update id="editar-cliente" parameterType="pojo.Cliente">
        UPDATE cliente SET 
            nombre = #{nombre},
            apellidoPaterno = #{apellidoPaterno},
            apellidoMaterno = #{apellidoMaterno},
            telefono = #{telefono},
            correo = #{correo}
        WHERE idCliente = #{idCliente}
    </update>
  
   <delete id="eliminar-cliente" parameterType="int">
        DELETE FROM cliente WHERE idCliente = #{idCliente}
    </delete>
    
    <select id="buscar-cliente-id" resultType="pojo.Cliente" parameterType="int">
        SELECT 
            cl.idCliente, 
            cl.nombre, 
            cl.apellidoPaterno, 
            cl.apellidoMaterno, 
            cl.telefono, 
            cl.correo, 
            cl.idDireccion,
            d.calle,
            d.numero,
            d.idColonia,
            col.nombre AS nombreColonia,
            col.codigo_postal AS codigoPostal,
            m.nombre AS ciudad,
            e.nombre AS estado,
            CONCAT_WS(', ', CONCAT_WS(' ', d.calle, d.numero), NULLIF(col.nombre, ''), CONCAT('C.P. ', NULLIF(col.codigo_postal, '')), NULLIF(m.nombre, ''), NULLIF(e.nombre, '') ) AS direccionCompleta
        FROM cliente cl 
        INNER JOIN direccion d ON cl.idDireccion = d.idDireccion 
        LEFT JOIN colonias col ON d.idColonia = col.id 
        LEFT JOIN municipios m ON col.municipio = m.id 
        LEFT JOIN estados e ON m.estado = e.id 
        WHERE cl.idCliente = #{idCliente}
    </select>
</mapper>